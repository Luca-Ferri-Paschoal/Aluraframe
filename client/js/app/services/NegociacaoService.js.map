{"version":3,"file":"NegociacaoService.js","names":["arrayDeObjeto","map","objeto","Negociacao","Date","data","quantidade","valor","HTTPService","ConnectionFactory","NegociacaoDao","NegociacaoService","semanaEscolida","get","then","objetos","catch","erro","console","log","Error","Promise","all","obterNegociacoesDaSemana","negociacoes","reduce","arrayAchatado","array","concat","negociacao","getConnection","connection","dao","adiciona","listaTodos","apagaTodos","listaAtual","obterNegociacoes","filter","some","negociacaoExistente","isEquals"],"sources":["../../app-es6/services/NegociacaoService.js"],"sourcesContent":["import { HTTPService } from './HTTPService.js';\r\nimport { ConnectionFactory } from './ConnectionFactory.js';\r\nimport { NegociacaoDao } from './../dao/NegociacaoDao.js';\r\nimport { Negociacao } from './../models/Negociacao.js';\r\n\r\nexport class NegociacaoService {\r\n    #http;\r\n\r\n    constructor() {\r\n        this.#http = new HTTPService();\r\n    }\r\n\r\n    obterNegociacoesDaSemana(semanaEscolida) {\r\n\r\n        return this.#http.get(`negociacoes/${semanaEscolida}`)\r\n        .then(objetos =>\r\n            this.#transformaObjetosEmNegociacoes(objetos)\r\n        )\r\n        .catch(erro => {\r\n            console.log(erro);\r\n            throw new Error(`Não foi possível obter as negociações da semana ${semanaEscolida}.`);\r\n        });\r\n        \r\n    }\r\n\r\n    obterNegociacoes() {\r\n        return Promise.all([\r\n            this.obterNegociacoesDaSemana('retrasada'),\r\n            this.obterNegociacoesDaSemana('anterior'),\r\n            this.obterNegociacoesDaSemana('atual'),\r\n        ])\r\n        .then(negociacoes => \r\n            negociacoes.reduce((arrayAchatado, array) => arrayAchatado.concat(array), [])\r\n        );\r\n    }\r\n\r\n    #transformaObjetosEmNegociacoes(arrayDeObjeto) {\r\n        return arrayDeObjeto.map(objeto =>\r\n            new Negociacao(\r\n                new Date(objeto.data),\r\n                objeto.quantidade,\r\n                objeto.valor\r\n            )\r\n        );\r\n    }\r\n\r\n    cadastra(negociacao) {\r\n        return ConnectionFactory\r\n        .getConnection()\r\n        .then(connection => new NegociacaoDao(connection))\r\n        .then(dao => dao.adiciona(negociacao))\r\n        .then(() => 'Negociação adicionanda com sucesso')\r\n        .catch(erro => {\r\n            console.log(erro);\r\n            throw new Error('Não foi possível adicionar a negociação.');\r\n        });\r\n    }\r\n\r\n    lista() {\r\n        return ConnectionFactory\r\n        .getConnection()\r\n        .then(connection => new NegociacaoDao(connection))\r\n        .then(dao => dao.listaTodos())\r\n        .catch(erro => {\r\n            console.log(erro);\r\n            throw new Error('Não foi possível obter as negociações.');\r\n        });\r\n    }\r\n\r\n    apaga() {\r\n        return ConnectionFactory\r\n        .getConnection()\r\n        .then(connection => new NegociacaoDao(connection))\r\n        .then(dao => dao.apagaTodos())\r\n        .then(() => 'Negociações apagadas com sucesso')\r\n        .catch(erro => {\r\n            console.log(erro);\r\n            throw new Error('Não foi possível apagar as negociações.');\r\n        });\r\n    }\r\n\r\n    importa(listaAtual) {\r\n        return this.obterNegociacoes()\r\n        .then(negociacoes => \r\n            negociacoes.filter(negociacao =>\r\n                !listaAtual.some(negociacaoExistente => negociacao.isEquals(negociacaoExistente))\r\n            )\r\n        )\r\n        .catch(erro => {\r\n            console.log(erro);\r\n            throw new Error('Não foi possível buscar negociações para importar.');\r\n        });\r\n    }\r\n}\r\n"],"mappings":"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"}