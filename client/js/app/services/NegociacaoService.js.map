{"version":3,"file":"NegociacaoService.js","names":["NegociacaoService","HTTPService","semanaEscolida","get","then","objetos","catch","erro","console","log","Error","Promise","all","obterNegociacoesDaSemana","negociacoes","reduce","arrayAchatado","array","concat","negociacao","ConnectionFactory","getConnection","connection","NegociacaoDao","dao","adiciona","listaTodos","apagaTodos","listaAtual","obterNegociacoes","filter","some","negociacaoExistente","isEquals","arrayDeObjeto","map","objeto","Negociacao","Date","data","quantidade","valor"],"sources":["../../app-es6/services/NegociacaoService.js"],"sourcesContent":["class NegociacaoService {\r\n    #http;\r\n\r\n    constructor() {\r\n        this.#http = new HTTPService();\r\n    }\r\n\r\n    obterNegociacoesDaSemana(semanaEscolida) {\r\n\r\n        return this.#http.get(`negociacoes/${semanaEscolida}`)\r\n        .then(objetos =>\r\n            this.#transformaObjetosEmNegociacoes(objetos)\r\n        )\r\n        .catch(erro => {\r\n            console.log(erro);\r\n            throw new Error(`Não foi possível obter as negociações da semana ${semanaEscolida}.`);\r\n        });\r\n        \r\n    }\r\n\r\n    obterNegociacoes() {\r\n        return Promise.all([\r\n            this.obterNegociacoesDaSemana('retrasada'),\r\n            this.obterNegociacoesDaSemana('anterior'),\r\n            this.obterNegociacoesDaSemana('atual'),\r\n        ])\r\n        .then(negociacoes => \r\n            negociacoes.reduce((arrayAchatado, array) => arrayAchatado.concat(array), [])\r\n        );\r\n    }\r\n\r\n    #transformaObjetosEmNegociacoes(arrayDeObjeto) {\r\n        return arrayDeObjeto.map(objeto =>\r\n            new Negociacao(\r\n                new Date(objeto.data),\r\n                objeto.quantidade,\r\n                objeto.valor\r\n            )\r\n        );\r\n    }\r\n\r\n    cadastra(negociacao) {\r\n        return ConnectionFactory\r\n        .getConnection()\r\n        .then(connection => new NegociacaoDao(connection))\r\n        .then(dao => dao.adiciona(negociacao))\r\n        .then(() => 'Negociação adicionanda com sucesso')\r\n        .catch(erro => {\r\n            console.log(erro);\r\n            throw new Error('Não foi possível adicionar a negociação.');\r\n        });\r\n    }\r\n\r\n    lista() {\r\n        return ConnectionFactory\r\n        .getConnection()\r\n        .then(connection => new NegociacaoDao(connection))\r\n        .then(dao => dao.listaTodos())\r\n        .catch(erro => {\r\n            console.log(erro);\r\n            throw new Error('Não foi possível obter as negociações.');\r\n        });\r\n    }\r\n\r\n    apaga() {\r\n        return ConnectionFactory\r\n        .getConnection()\r\n        .then(connection => new NegociacaoDao(connection))\r\n        .then(dao => dao.apagaTodos())\r\n        .then(() => 'Negociações apagadas com sucesso')\r\n        .catch(erro => {\r\n            console.log(erro);\r\n            throw new Error('Não foi possível apagar as negociações.');\r\n        });\r\n    }\r\n\r\n    importa(listaAtual) {\r\n        return this.obterNegociacoes()\r\n        .then(negociacoes => \r\n            negociacoes.filter(negociacao =>\r\n                !listaAtual.some(negociacaoExistente => negociacao.isEquals(negociacaoExistente))\r\n            )\r\n        )\r\n        .catch(erro => {\r\n            console.log(erro);\r\n            throw new Error('Não foi possível buscar negociações para importar.');\r\n        });\r\n    }\r\n}\r\n"],"mappings":"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"}